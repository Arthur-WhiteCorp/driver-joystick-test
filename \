cmake_minimum_required(VERSION 3.16)
project(Joystick-driver NONE)

# Get running kernel version
execute_process(
    COMMAND uname -r
    OUTPUT_VARIABLE KERNEL_RELEASE
    OUTPUT_STRIP_TRAILING_WHITESPACE
)

set(KERNEL_BUILD_DIR "/lib/modules/${KERNEL_RELEASE}/build")

if(NOT EXISTS ${KERNEL_BUILD_DIR})
    message(FATAL_ERROR "Kernel build directory not found")
endif()

# Kernel module build target
add_custom_target(
    kernel_module ALL
    COMMAND make -C ${KERNEL_BUILD_DIR}
            M=${CMAKE_CURRENT_SOURCE_DIR}/kernel
            modules
)

# Clean target
add_custom_target(
    kernel_module_clean
    COMMAND make -C ${KERNEL_BUILD_DIR}
            M=${CMAKE_CURRENT_SOURCE_DIR}/kernel
            clean
)

